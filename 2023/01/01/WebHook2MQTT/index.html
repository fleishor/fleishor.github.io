<html lang="en"><head><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css"></head><body><x_layout_ejs">
  
  

  <x_partial_head_ejs>

  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Tachyons Core CSS -->
    <link rel="stylesheet" href="https://unpkg.com/tachyons@4.12.0/css/tachyons.min.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- Custom CSS -->
    
<link rel="stylesheet" href="/css/style.css">

  <meta name="generator" content="Hexo 6.3.0">
</x_partial_head_ejs>

  

    <x_post_ejs>
   <!-- Banner -->
   <x_partial_banner_ejs>
   <div class="w-100 bg-banner ph5-ns ph3 text-light mb4">

      <nav class="db dt-l w-100 mw10 center border-box pv3">
         <div class="db dtc-l v-mid w-100 w-75-l tc tr-l">
            
            <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/" title="Home">
               Home
            </a>
            
         </div>
      </nav>

      <!-- Title -->
      <div class="w-100 mw10 center vh-20 dt">
         <div class="dtc v-mid white">
            <h1 class="f1-l f2-m tc tc-m tl-ns mv0">My Digital Garden</h1>
            <p class="ma0 pb3 f4 fw3 tc tc-m tl-ns">Digital Garden of Horst Fleischer</p>
         </div>
      </div>
   </div>
</x_partial_banner_ejs>

   <!-- Content -->
   <div class="w-100 ph2 ph4-m ph5-l">
      <div class="content">
         <div class="fl w-100 w-80-l mw9 left pr4-ns pr0-m mb4 br-l b--light-gray post-content">
            <h1>
               WebHook2MQTT
            </h1>
            <div>
               Forward WebHook POST Requests as MQTT
            </div>
            <!-- Main Post Content -->
            <h1 id="References"><a href="#References" class="headerlink" title="References"></a>References</h1><p><a target="_blank" rel="noopener" href="https://betterstack.com/community/guides/logging/how-to-install-setup-and-use-winston-and-morgan-to-log-node-js-applications/">https://betterstack.com/community/guides/logging/how-to-install-setup-and-use-winston-and-morgan-to-log-node-js-applications/</a><br><a target="_blank" rel="noopener" href="http://www.steves-internet-guide.com/using-node-mqtt-client/">http://www.steves-internet-guide.com/using-node-mqtt-client/</a><br><a target="_blank" rel="noopener" href="https://nodejs.org/en/docs/guides/nodejs-docker-webapp/">https://nodejs.org/en/docs/guides/nodejs-docker-webapp/</a></p>
<h1 id="File-tsconfig-json"><a href="#File-tsconfig-json" class="headerlink" title="File tsconfig.json"></a>File tsconfig.json</h1><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">&nbsp; <span class="attr">"compilerOptions"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">&nbsp; &nbsp; <span class="attr">"module"</span><span class="punctuation">:</span> <span class="string">"commonjs"</span><span class="punctuation">,</span></span><br><span class="line">&nbsp; &nbsp; <span class="attr">"esModuleInterop"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">&nbsp; &nbsp; <span class="attr">"target"</span><span class="punctuation">:</span> <span class="string">"es6"</span><span class="punctuation">,</span></span><br><span class="line">&nbsp; &nbsp; <span class="attr">"moduleResolution"</span><span class="punctuation">:</span> <span class="string">"node"</span><span class="punctuation">,</span></span><br><span class="line">&nbsp; &nbsp; <span class="attr">"sourceMap"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">&nbsp; &nbsp; <span class="attr">"outDir"</span><span class="punctuation">:</span> <span class="string">"dist"</span></span><br><span class="line">&nbsp; <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">&nbsp; <span class="attr">"lib"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">"es2015"</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="File-package-json"><a href="#File-package-json" class="headerlink" title="File  package.json"></a>File  package.json</h1><figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span> <span class="string">"webhook2mqtt"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"version"</span><span class="punctuation">:</span> <span class="string">"1.0.0"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"description"</span><span class="punctuation">:</span> <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"main"</span><span class="punctuation">:</span> <span class="string">"./dist/webhook2mqtt.js"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"scripts"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"buildImage"</span><span class="punctuation">:</span> <span class="string">"docker build . -t webhook2mqtt"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"build"</span><span class="punctuation">:</span> <span class="string">"npx tsc"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"webhook2mqtt"</span><span class="punctuation">:</span> <span class="string">"node ./dist/webhook2mqtt.js"</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"author"</span><span class="punctuation">:</span> <span class="string">""</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"license"</span><span class="punctuation">:</span> <span class="string">"ISC"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"devDependencies"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"@types/express"</span><span class="punctuation">:</span> <span class="string">"^4.17.15"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"@types/node"</span><span class="punctuation">:</span> <span class="string">"^18.14.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"@typescript-eslint/eslint-plugin"</span><span class="punctuation">:</span> <span class="string">"^5.53.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"@typescript-eslint/parser"</span><span class="punctuation">:</span> <span class="string">"^5.53.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"eslint"</span><span class="punctuation">:</span> <span class="string">"^8.34.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"typescript"</span><span class="punctuation">:</span> <span class="string">"^4.9.4"</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"dependencies"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"body-parser"</span><span class="punctuation">:</span> <span class="string">"^1.20.1"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"express"</span><span class="punctuation">:</span> <span class="string">"^4.18.2"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"express-winston"</span><span class="punctuation">:</span> <span class="string">"^4.2.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"mqtt"</span><span class="punctuation">:</span> <span class="string">"^4.3.7"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"uuid"</span><span class="punctuation">:</span> <span class="string">"^9.0.0"</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">"winston"</span><span class="punctuation">:</span> <span class="string">"^3.8.2"</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<h1 id="File-eslintrc-jrc"><a href="#File-eslintrc-jrc" class="headerlink" title="File .eslintrc.jrc"></a>File .eslintrc.jrc</h1><figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = {</span><br><span class="line">   <span class="attr">extends</span>: [<span class="string">"eslint:recommended"</span>, <span class="string">"plugin:@typescript-eslint/recommended"</span>],</span><br><span class="line">   <span class="attr">parser</span>: <span class="string">"@typescript-eslint/parser"</span>,</span><br><span class="line">   <span class="attr">plugins</span>: [<span class="string">"@typescript-eslint"</span>],</span><br><span class="line">   <span class="attr">root</span>: <span class="literal">true</span>,</span><br><span class="line">};</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h1><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">FROM</span> <span class="string">node:19.3.0-alpine3.16</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create app directory</span></span><br><span class="line"><span class="string">WORKDIR</span> <span class="string">/webhook2mqtt</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Install app dependencies</span></span><br><span class="line"><span class="comment"># A wildcard is used to ensure both package.json AND package-lock.json are copied</span></span><br><span class="line"><span class="comment"># where available (npm@5+)</span></span><br><span class="line"><span class="string">COPY</span> <span class="string">package*.json</span> <span class="string">./</span></span><br><span class="line"></span><br><span class="line"><span class="string">RUN</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"><span class="comment"># If you are building your code for production</span></span><br><span class="line"><span class="comment"># RUN npm ci --only=production</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Bundle app source</span></span><br><span class="line"><span class="string">COPY</span> <span class="string">./dist/webhook2mqtt.js</span> <span class="string">.</span></span><br><span class="line"></span><br><span class="line"><span class="string">EXPOSE</span> <span class="number">3001</span></span><br><span class="line"><span class="string">CMD</span> [ <span class="string">"node"</span>, <span class="string">"/webhook2mqtt/webhook2mqtt.js"</span> ]</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Generate-Javascript-from-Typescript"><a href="#Generate-Javascript-from-Typescript" class="headerlink" title="Generate Javascript from Typescript"></a>Generate Javascript from Typescript</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run build</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Run-webhook2mqtt-js"><a href="#Run-webhook2mqtt-js" class="headerlink" title="Run webhook2mqtt.js"></a>Run webhook2mqtt.js</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run webhook2mqtt</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Create-Docker-image"><a href="#Create-Docker-image" class="headerlink" title="Create Docker image"></a>Create Docker image</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run buildImage</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Source-code-webhook2mqtt-ts"><a href="#Source-code-webhook2mqtt-ts" class="headerlink" title="Source code webhook2mqtt.ts"></a>Source code webhook2mqtt.ts</h1><figure class="highlight typescript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">"express"</span>;</span><br><span class="line"><span class="keyword">import</span> bodyParser <span class="keyword">from</span> <span class="string">"body-parser"</span>;</span><br><span class="line"><span class="keyword">import</span> winston <span class="keyword">from</span> <span class="string">"winston"</span>;</span><br><span class="line"><span class="keyword">import</span> expressWinston <span class="keyword">from</span> <span class="string">"express-winston"</span>;</span><br><span class="line"><span class="keyword">import</span> { v4 <span class="keyword">as</span> uuidv4 } <span class="keyword">from</span> <span class="string">"uuid"</span>;</span><br><span class="line"><span class="keyword">import</span> mqtt <span class="keyword">from</span> <span class="string">"mqtt"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> expressApp = <span class="title function_">express</span>();</span><br><span class="line"><span class="keyword">const</span> expressPort = <span class="number">3001</span>;</span><br><span class="line"><span class="keyword">const</span> grafanaRoute = <span class="string">"/Grafana/*"</span>;</span><br><span class="line"><span class="keyword">const</span> mqttBroker = <span class="string">"mqtt://docker.fritz.box"</span>;</span><br><span class="line"><span class="keyword">const</span> mqttClientId = <span class="string">"webhook2mqtt"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> loggerUuid = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Create Logger</span></span><br><span class="line"><span class="keyword">const</span> logger = winston.<span class="title function_">createLogger</span>({</span><br><span class="line">   <span class="attr">level</span>: <span class="string">"info"</span>,</span><br><span class="line">   <span class="attr">format</span>: winston.<span class="property">format</span>.<span class="title function_">combine</span>(winston.<span class="property">format</span>.<span class="title function_">timestamp</span>(), winston.<span class="property">format</span>.<span class="title function_">json</span>(), winston.<span class="property">format</span>.<span class="title function_">errors</span>({ <span class="attr">stack</span>: <span class="literal">true</span> })),</span><br><span class="line">   <span class="attr">transports</span>: [<span class="keyword">new</span> winston.<span class="property">transports</span>.<span class="title class_">Console</span>()],</span><br><span class="line">   <span class="attr">exceptionHandlers</span>: [<span class="keyword">new</span> winston.<span class="property">transports</span>.<span class="title class_">Console</span>()],</span><br><span class="line">   <span class="attr">rejectionHandlers</span>: [<span class="keyword">new</span> winston.<span class="property">transports</span>.<span class="title class_">Console</span>()],</span><br><span class="line">   <span class="attr">defaultMeta</span>: {</span><br><span class="line">      <span class="keyword">get</span> <span class="title function_">uuid</span>() {</span><br><span class="line">         <span class="keyword">return</span> loggerUuid;</span><br><span class="line">      },</span><br><span class="line">   },</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> expressLogger = expressWinston.<span class="title function_">logger</span>({ <span class="attr">winstonInstance</span>: logger });</span><br><span class="line"><span class="keyword">const</span> expressErrorLogger = expressWinston.<span class="title function_">errorLogger</span>({ <span class="attr">winstonInstance</span>: logger });</span><br><span class="line"></span><br><span class="line"><span class="comment">// Add POST request helper</span></span><br><span class="line">expressApp.<span class="title function_">use</span>(expressLogger);</span><br><span class="line">expressApp.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>({ <span class="attr">extended</span>: <span class="literal">false</span> }));</span><br><span class="line">expressApp.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">expressApp.<span class="title function_">use</span>(expressErrorLogger);</span><br><span class="line"><span class="comment">// eslint-disable-next-line @typescript-eslint/no-unused-vars</span></span><br><span class="line">expressApp.<span class="title function_">use</span>(<span class="keyword">function</span> (<span class="params">err, req, res, next</span>) {</span><br><span class="line">   res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">"Internal Error"</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// Connect to MQTT Broker</span></span><br><span class="line"><span class="keyword">let</span> mqttClientConnected = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">const</span> mqttClient = mqtt.<span class="title function_">connect</span>(mqttBroker, { <span class="attr">clientId</span>: mqttClientId });</span><br><span class="line"></span><br><span class="line"><span class="comment">// Handle POST request for /Grafana/*</span></span><br><span class="line">expressApp.<span class="title function_">post</span>(grafanaRoute, <span class="function">(<span class="params">request, response</span>) =&gt;</span> {</span><br><span class="line">   <span class="comment">// generate new uuid</span></span><br><span class="line">   loggerUuid = <span class="title function_">uuidv4</span>();</span><br><span class="line">   logger.<span class="title function_">info</span>(<span class="string">`Received POST requst for url "<span class="subst">${request.path}</span>"`</span>, {</span><br><span class="line">      <span class="attr">request_path</span>: request.<span class="property">path</span>,</span><br><span class="line">      <span class="attr">request_body</span>: request.<span class="property">body</span>,</span><br><span class="line">   });</span><br><span class="line">   <span class="keyword">const</span> grafanaAlert = request.<span class="property">body</span>;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// forward POST request to MQTT</span></span><br><span class="line">   <span class="keyword">if</span> (mqttClientConnected) {</span><br><span class="line">      <span class="keyword">const</span> mqttPrefix = <span class="string">"webhook2mqtt"</span>;</span><br><span class="line">      <span class="keyword">const</span> mqttWebHook = <span class="string">"Grafana"</span>;</span><br><span class="line">      <span class="keyword">const</span> mqttAlertName = grafanaAlert.<span class="property">commonLabels</span>.<span class="property">alertname</span>;</span><br><span class="line">      <span class="keyword">const</span> topic = <span class="string">"/"</span> + mqttPrefix + <span class="string">"/"</span> + mqttWebHook + <span class="string">"/"</span> + mqttAlertName;</span><br><span class="line">      <span class="keyword">const</span> mqttPayload = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>({</span><br><span class="line">         <span class="attr">topic</span>: topic,</span><br><span class="line">         <span class="attr">mqttPrefix</span>: mqttPrefix,</span><br><span class="line">         <span class="attr">mqttWebHook</span>: mqttWebHook,</span><br><span class="line">         <span class="attr">mqttAlertName</span>: mqttAlertName,</span><br><span class="line">         <span class="attr">path</span>: request.<span class="property">path</span>,</span><br><span class="line">         <span class="attr">payload</span>: request.<span class="property">body</span>,</span><br><span class="line">      });</span><br><span class="line"></span><br><span class="line">      logger.<span class="title function_">info</span>(<span class="string">"Publish to MQTT with topic "</span> + topic, { <span class="attr">topic</span>: topic, <span class="attr">payload</span>: mqttPayload });</span><br><span class="line">      mqttClient.<span class="title function_">publish</span>(topic, mqttPayload);</span><br><span class="line">   }</span><br><span class="line">   response.<span class="title function_">end</span>();</span><br><span class="line">   loggerUuid = <span class="literal">null</span>;</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">mqttClient.<span class="title function_">on</span>(<span class="string">"connect"</span>, <span class="function">() =&gt;</span> {</span><br><span class="line">   mqttClientConnected = <span class="literal">true</span>;</span><br><span class="line">   logger.<span class="title function_">info</span>(<span class="string">"Connected to MQTT Broker"</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line">mqttClient.<span class="title function_">on</span>(<span class="string">"error"</span>, <span class="keyword">function</span> (<span class="params">error</span>) {</span><br><span class="line">   logger.<span class="title function_">error</span>(<span class="string">"Error connecting to MQTT Broker, Error:"</span> + error);</span><br><span class="line">   process.<span class="title function_">exit</span>(<span class="number">1</span>);</span><br><span class="line">});</span><br><span class="line"></span><br><span class="line"><span class="comment">// Start HTTP Server</span></span><br><span class="line">expressApp.<span class="title function_">listen</span>(expressPort, <span class="function">() =&gt;</span> {</span><br><span class="line">   logger.<span class="title function_">info</span>(<span class="string">`Express is listening at http://localhost:<span class="subst">${expressPort}</span>`</span>);</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Create-new-user-webhook2mqtt"><a href="#Create-new-user-webhook2mqtt" class="headerlink" title="Create new user webhook2mqtt"></a>Create new user webhook2mqtt</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -m webhook2mqtt</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Add-user-webhook2mqtt-to-docker-group"><a href="#Add-user-webhook2mqtt-to-docker-group" class="headerlink" title="Add user webhook2mqtt to docker group"></a>Add user webhook2mqtt to docker group</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo usermod -aG docker webhook2mqtt</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Login-as-user-webhook2mqtt"><a href="#Login-as-user-webhook2mqtt" class="headerlink" title="Login as user webhook2mqtt"></a>Login as user webhook2mqtt</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u webhook2mqtt -i</span><br></pre></td></tr></tbody></table></figure>

<h1 id="Get-uid-and-gid-for-user-webhook2mqtt"><a href="#Get-uid-and-gid-for-user-webhook2mqtt" class="headerlink" title="Get uid and gid for user webhook2mqtt"></a>Get uid and gid for user webhook2mqtt</h1><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">webhook2mqtt@docker:~ $ <span class="built_in">id</span></span><br><span class="line">uid=1014(webhook2mqtt) gid=1014(webhook2mqtt) <span class="built_in">groups</span>=1014(webhook2mqtt),995(docker)</span><br></pre></td></tr></tbody></table></figure>

<h1 id="File-docker-compose-yaml"><a href="#File-docker-compose-yaml" class="headerlink" title="File docker-compose.yaml"></a>File docker-compose.yaml</h1><figure class="highlight yaml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.5"</span></span><br><span class="line"></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">webhook2mqtt:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">webhook2mqtt:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">webhook2mqtt</span></span><br><span class="line">    <span class="attr">user:</span> <span class="number">1014</span><span class="string">:995</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">influxdb2</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"3001:3001"</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">    <span class="attr">influxdb2:</span></span><br><span class="line">        <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">"influxdb2"</span></span><br></pre></td></tr></tbody></table></figure>

         </div>
         <!-- right side bar-->
         <div class="fl w-100 w-20-l pl1-ns mb4">

            <!-- Widget 1: Tags -->
            
            <x_partial_widget_tags_ejs>
  <div class="">
    <h2>Tags</h2>
    
    <p>
      <a class="fw3 ph1 dib" href="/tags/Docker/">Docker</a>
    </p>
    
    <p>
      <a class="fw3 ph1 dib" href="/tags/MQTT/">MQTT</a>
    </p>
    
    <p>
      <a class="fw3 ph1 dib" href="/tags/NodeJS/">NodeJS</a>
    </p>
    
    <p>
      <a class="fw3 ph1 dib" href="/tags/ExpressJS/">ExpressJS</a>
    </p>
    
    <p>
      <a class="fw3 ph1 dib" href="/tags/Typescript/">Typescript</a>
    </p>
    
    <p>
      <a class="fw3 ph1 dib" href="/tags/Dockerfile/">Dockerfile</a>
    </p>
    
  </div>
</x_partial_widget_tags_ejs>
            
         </div>
      </div>
   </div>
</x_post_ejs>

    <x_partial_footer_ejs>
   <div class="fixed db w-100 tc tr-l bg-1 bottom-0">
      <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/admin/datenschutzerklaerung.html" title="Datenschutzerklärung">
         Datenschutzerklärung
      </a>
      <a class="link dim f6 f5-l dib mr3 mr4-l white" href="/admin/impressum.html" title="Impressum">
         Impressum
      </a>
   </div>
</x_partial_footer_ejs>

  

  
</x_layout_ejs"></body><script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.js"></script><script>window.addEventListener("load", function(){window.cookieconsent.initialise({"theme":"classic","position":"bottom","static":true,"cookie":{"expiryDays":7},"content":{"message":"This website uses cookies to ensure you get the best experience on our website. Who doesn't like cookies?","dismiss":"Feed me"}})});</script></html>